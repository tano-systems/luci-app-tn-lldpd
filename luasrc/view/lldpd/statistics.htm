<%#
 Copyright (c) 2018, Tano Systems. All Rights Reserved.
 Anton Kikin <a.kikin@tano-systems.com>
-%>

<%+header%>

<style type="text/css">
	table.keyvalue-markup { border: 0; }
	table.keyvalue-markup td { padding: 2px 10px 2px 0; background-color: inherit !important; line-height: 16px; }
	table.keyvalue-markup td:first-of-type { vertical-align: top; font-weight: bold; white-space: nowrap; }
	table.keyvalue-markup td:last-of-type { width: 100%; }
</style>

<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
<script type="text/javascript">//<![CDATA[

	function add_obj_row(description, value)
	{
		if (typeof value == 'undefined')
			return

		return '<tr><td>' + description +
			':</td><td>' + value + '</td></tr>';
	}

	function add_iface_row(i, sobj, iobj)
	{
		var row = [];
		var inner = "";

		inner += '<table class="keyvalue-markup">';
		inner += add_obj_row("<%:Interface%>", iobj.name);
		inner += add_obj_row("<%:Protocol%>", iobj.via);
		inner += add_obj_row("<%:Age%>", iobj.age);
		inner += add_obj_row("<%:Port ID%>", iobj.port[0].id[0].value);
		inner += add_obj_row("<%:Port ID type%>", iobj.port[0].id[0].type);
		inner += add_obj_row("<%:Port description%>", iobj.port[0].descr[0].value);
		inner += add_obj_row("<%:TTL%>", iobj.ttl[0].ttl);
		inner += "</table>";

		row.push(inner);
		row.push(sobj.tx[0].tx);
		row.push(sobj.rx[0].rx);
		row.push(sobj.rx_discarded_cnt[0].rx_discarded_cnt);
		row.push(sobj.rx_unrecognized_cnt[0].rx_unrecognized_cnt);
		row.push(sobj.ageout_cnt[0].ageout_cnt);
		row.push(sobj.insert_cnt[0].insert_cnt);
		row.push(sobj.delete_cnt[0].delete_cnt);

		return row;
	}

	XHR.poll(5, '<%=url('admin/services/lldpd/get_statistics')%>', null,
		function(x, json)
		{
			var counters_table =
				document.getElementById('lldpd-counters');

			var statistics = json.statistics;
			var interfaces = json.interfaces;

			var sifaces = statistics.lldp[0].interface;
			var ifaces  = interfaces.lldp[0].interface;

			var rows = [];

			if ((typeof sifaces !== 'undefined') &&
			    (typeof  ifaces !== 'undefined')) {
				for (var i = 0; i < sifaces.length; i++)
					rows.push(add_iface_row(i, sifaces[i], ifaces[i]))
			}

			cbi_update_table(counters_table, rows, '<em><%:No information available%></em>');
		}
	)
//]]></script>

<h2 name="content"><%:LLDPd: Statistics%></h2>
<div class="cbi-map-descr"><%:This page allows you to see LLDPd interfaces statistics%></div>

<fieldset class="cbi-section" id="cbi-table-table">
	<div class="cbi-section-node">
		<div class="table" id="lldpd-counters">
			<div class="tr table-titles">
				<div class="th col-1 top"><%:Local interface%></div>
				<div class="th col-1 top"><%:Tx%></div>
				<div class="th col-1 top"><%:Rx%></div>
				<div class="th col-1 top"><%:Rx discarded%></div>
				<div class="th col-1 top"><%:Rx unrecognized%></div>
				<div class="th col-1 top"><%:Ageout count%></div>
				<div class="th col-1 top"><%:Insert count%></div>
				<div class="th col-1 top"><%:Delete count%></div>
			</div>
			<div class="tr placeholder">
				<div class="td">
					<em><%:Collecting data...%></em>
				</div>
			</div>
		</div>
	</div>
</fieldset>

<% include("lldpd/footer") -%>
<%+footer%>
